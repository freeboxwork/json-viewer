<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Viewer & Formatter Online - Free JSON Beautifier</title>
    <meta name="description" content="Free online JSON viewer, formatter and beautifier. Visualize JSON as an interactive tree, format with syntax highlighting, search keys, and copy JSONPath.">
    <meta property="og:title" content="JSON Viewer & Formatter Online">
    <meta property="og:description" content="Free online JSON viewer and formatter with tree view, syntax highlighting, and search.">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="style.css">
</head>
<body class="fixed-layout">
    <script src="app.js"></script>
    <script>document.write(getNavHTML('viewer'));</script>

    <main>
        <div class="page-header">
            <h1>JSON Viewer & Formatter</h1>
            <p>Paste your JSON to visualize, format, and explore with an interactive tree view</p>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="btn btn-primary" onclick="formatJSON()">&#9998; Format</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <label class="option-group">
                    <span style="font-size:0.82rem;color:var(--text-secondary);font-weight:600;">Indent:</span>
                    <select class="select" id="indentSelect">
                        <option value="2" selected>2 Spaces</option>
                        <option value="4">4 Spaces</option>
                        <option value="tab">Tab</option>
                    </select>
                </label>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <button class="btn btn-secondary btn-sm" onclick="triggerUpload('jsonInput', formatJSON)">&#128194; Upload</button>
                <button class="btn btn-secondary btn-sm" onclick="loadSample()">Sample</button>
                <button class="btn btn-secondary btn-sm" onclick="copyOutput()">&#128203; Copy</button>
                <button class="btn btn-secondary btn-sm" onclick="downloadOutput()">&#11015; Download</button>
                <button class="btn btn-danger btn-sm" onclick="clearAll()">&#128465; Clear</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="input" onclick="onTabSwitch('input')">Input</button>
            <button class="tab" data-tab="formatted" onclick="onTabSwitch('formatted')">Formatted</button>
            <button class="tab" data-tab="tree" onclick="onTabSwitch('tree')">Tree View</button>
        </div>

        <!-- Tab Body -->
        <div class="tab-body">
            <!-- Input Tab -->
            <div class="tab-panel active" id="panel-input">
                <textarea class="editor-area" id="jsonInput" placeholder="Paste your JSON here...

Drag & drop a .json file, or click Upload above.

Keyboard shortcut: Ctrl+Enter to format." spellcheck="false"></textarea>
            </div>

            <!-- Formatted Tab -->
            <div class="tab-panel" id="panel-formatted">
                <div class="output-area" id="formattedOutput">
                    <div style="color:var(--text-muted);text-align:center;padding-top:140px;">
                        <div style="font-size:3rem;margin-bottom:12px;">{ }</div>
                        <p>Paste JSON in the Input tab, then click Format</p>
                    </div>
                </div>
            </div>

            <!-- Tree View Tab -->
            <div class="tab-panel tab-panel-flex" id="panel-tree" style="flex-direction:column;height:100%;">
                <div class="tree-panel-content">
                    <div class="tree-toolbar">
                        <div class="toolbar-group">
                            <button class="btn btn-secondary btn-sm" onclick="toggleAllNodes(true)">Expand All</button>
                            <button class="btn btn-secondary btn-sm" onclick="toggleAllNodes(false)">Collapse All</button>
                        </div>
                    </div>
                    <div class="output-area" id="treeOutput">
                        <div style="color:var(--text-muted);text-align:center;padding-top:140px;">
                            <div style="font-size:3rem;margin-bottom:12px;">&#127795;</div>
                            <p>Paste JSON in the Input tab, then switch to Tree View</p>
                        </div>
                    </div>
                    <div class="tree-search-bar">
                        <span style="color:var(--text-muted);font-size:0.82rem;">&#128269;</span>
                        <input type="text" class="input" placeholder="Search keys / values..." id="treeSearch" oninput="onSearch(this.value)" style="flex:1;padding:6px 10px;font-size:0.82rem;">
                        <span class="search-count" id="searchCount"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div class="status-item">
                <div class="status-dot neutral" id="statusDot"></div>
                <span id="statusText">Ready</span>
            </div>
            <div style="margin-left:auto;font-size:0.78rem;color:var(--text-muted);" id="inputSize"></div>
        </div>
    </main>

    <script>document.write(getFooterHTML());</script>

    <script>
        const input = document.getElementById('jsonInput');
        let parsedData = null;

        // Setup textarea as drop target
        setupTextareaDrop('jsonInput', formatJSON);

        // Update input size indicator
        input.addEventListener('input', () => {
            const size = new Blob([input.value]).size;
            document.getElementById('inputSize').textContent = input.value ? formatBytes(size) : '';
        });

        // Tab switch with auto-parsing
        function onTabSwitch(tabId) {
            if ((tabId === 'tree' || tabId === 'formatted') && !parsedData) {
                const text = input.value.trim();
                if (text) {
                    const result = parseJSON(text);
                    if (result.success) {
                        parsedData = result.data;
                        const indent = getIndent();
                        const formatted = JSON.stringify(parsedData, null, indent);

                        // Update formatted view
                        document.getElementById('formattedOutput').innerHTML =
                            '<div class="code-view">' + syntaxHighlight(formatted) + '</div>';

                        // Update tree view
                        document.getElementById('treeOutput').innerHTML =
                            '<div class="tree-view">' + buildTreeHTML(parsedData) + '</div>';

                        const stats = getJSONStats(parsedData);
                        showStatus('Valid JSON \u2014 ' + stats.keys + ' keys, ' + stats.objects + ' objects, ' + stats.arrays + ' arrays, depth ' + stats.depth, 'valid');

                        const size = new Blob([formatted]).size;
                        document.getElementById('inputSize').textContent = formatBytes(size);
                    } else {
                        showStatus('Error: ' + result.error.message + (result.error.line ? ' (line ' + result.error.line + ', col ' + result.error.col + ')' : ''), 'invalid');
                    }
                }
            }
            switchTab(tabId);
        }

        function getIndent() {
            const v = document.getElementById('indentSelect').value;
            return v === 'tab' ? '\t' : parseInt(v);
        }

        function formatJSON() {
            const text = input.value.trim();
            if (!text) {
                showStatus('Please enter JSON', 'invalid');
                return;
            }

            const result = parseJSON(text);
            if (!result.success) {
                showStatus(`Error: ${result.error.message}${result.error.line ? ` (line ${result.error.line}, col ${result.error.col})` : ''}`, 'invalid');
                document.getElementById('formattedOutput').innerHTML = `<div style="color:var(--error);padding:20px;"><strong>Invalid JSON</strong><br><br>${result.error.message}${result.error.line ? `<br>Line: ${result.error.line}, Column: ${result.error.col}` : ''}</div>`;
                switchTab('formatted');
                return;
            }

            parsedData = result.data;
            const indent = getIndent();
            const formatted = JSON.stringify(parsedData, null, indent);
            input.value = formatted;

            // Update formatted view
            document.getElementById('formattedOutput').innerHTML = `<div class="code-view">${syntaxHighlight(formatted)}</div>`;

            // Update tree view
            document.getElementById('treeOutput').innerHTML = `<div class="tree-view">${buildTreeHTML(parsedData)}</div>`;

            // Switch to formatted tab
            switchTab('formatted');

            const stats = getJSONStats(parsedData);
            showStatus(`Valid JSON \u2014 ${stats.keys} keys, ${stats.objects} objects, ${stats.arrays} arrays, depth ${stats.depth}`, 'valid');

            const size = new Blob([formatted]).size;
            document.getElementById('inputSize').textContent = formatBytes(size);
        }

        function onSearch(keyword) {
            const count = searchTree(keyword);
            document.getElementById('searchCount').textContent = keyword ? `${count} found` : '';
        }

        function copyOutput() {
            if (!parsedData) { showToast('Nothing to copy', 'error'); return; }
            const indent = getIndent();
            copyToClipboard(JSON.stringify(parsedData, null, indent));
        }

        function downloadOutput() {
            if (!parsedData) { showToast('Nothing to download', 'error'); return; }
            const indent = getIndent();
            downloadFile(JSON.stringify(parsedData, null, indent), 'formatted.json');
        }

        function clearAll() {
            input.value = '';
            document.getElementById('formattedOutput').innerHTML = `<div style="color:var(--text-muted);text-align:center;padding-top:140px;"><div style="font-size:3rem;margin-bottom:12px;">{ }</div><p>Paste JSON in the Input tab, then click Format</p></div>`;
            document.getElementById('treeOutput').innerHTML = `<div style="color:var(--text-muted);text-align:center;padding-top:140px;"><div style="font-size:3rem;margin-bottom:12px;">&#127795;</div><p>Paste JSON in the Input tab, then switch to Tree View</p></div>`;
            parsedData = null;
            document.getElementById('inputSize').textContent = '';
            document.getElementById('searchCount').textContent = '';
            showStatus('Ready', 'neutral');
            switchTab('input');
        }

        function loadSample() {
            const sample = {
                "name": "JSON Tools",
                "version": "1.0.0",
                "description": "A collection of free online JSON utilities",
                "features": ["Viewer", "Formatter", "Validator", "Converter", "Diff"],
                "author": {
                    "name": "Developer",
                    "email": "dev@example.com",
                    "website": "https://example.com"
                },
                "stats": { "users": 15000, "rating": 4.8, "isOpen": true, "lastUpdate": null },
                "tags": [
                    { "id": 1, "name": "json", "color": "#3b82f6" },
                    { "id": 2, "name": "tools", "color": "#22c55e" },
                    { "id": 3, "name": "online", "color": "#f59e0b" }
                ]
            };
            input.value = JSON.stringify(sample, null, 2);
            formatJSON();
        }

        function showStatus(text, type) {
            document.getElementById('statusText').textContent = text;
            document.getElementById('statusDot').className = 'status-dot ' + type;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                formatJSON();
            }
        });
    </script>
</body>
</html>
