<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Viewer & Formatter Online - Free JSON Beautifier</title>
    <meta name="description" content="Free online JSON viewer, formatter and beautifier. Visualize JSON as an interactive tree, format with syntax highlighting, search keys, and copy JSONPath.">
    <meta property="og:title" content="JSON Viewer & Formatter Online">
    <meta property="og:description" content="Free online JSON viewer and formatter with tree view, syntax highlighting, and search.">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="app.js"></script>
    <script>document.write(getNavHTML('viewer'));</script>

    <main>
        <div class="page-header">
            <h1>JSON Viewer & Formatter</h1>
            <p>Paste your JSON to visualize, format, and explore with an interactive tree view</p>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="btn btn-primary" onclick="formatJSON()">&#9998; Format</button>
                <button class="btn btn-secondary" onclick="viewTree()">&#127795; Tree View</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <label class="option-group">
                    <span style="font-size:0.82rem;color:var(--text-secondary);font-weight:600;">Indent:</span>
                    <select class="select" id="indentSelect">
                        <option value="2" selected>2 Spaces</option>
                        <option value="4">4 Spaces</option>
                        <option value="tab">Tab</option>
                    </select>
                </label>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <button class="btn btn-secondary btn-sm" onclick="loadSample()">Sample</button>
                <button class="btn btn-secondary btn-sm" onclick="copyOutput()">&#128203; Copy</button>
                <button class="btn btn-secondary btn-sm" onclick="downloadOutput()">&#11015; Download</button>
                <button class="btn btn-danger btn-sm" onclick="clearAll()">&#128465; Clear</button>
            </div>
        </div>

        <!-- Drop Zone -->
        <div class="drop-zone" id="dropZone">
            <div class="drop-icon">&#128194;</div>
            <div class="drop-text">Drop a JSON file here or <span>click to upload</span></div>
        </div>

        <!-- Editor Layout -->
        <div class="editor-layout">
            <!-- Input Panel -->
            <div class="editor-panel">
                <div class="panel-header">
                    <span class="panel-title">Input JSON</span>
                    <span style="font-size:0.75rem;color:var(--text-muted);" id="inputSize"></span>
                </div>
                <textarea class="editor-area" id="jsonInput" placeholder='Paste your JSON here...\n\nExample:\n{\n  "name": "John",\n  "age": 30\n}' spellcheck="false"></textarea>
            </div>

            <!-- Output Panel -->
            <div class="editor-panel">
                <div class="panel-header">
                    <span class="panel-title" id="outputTitle">Output</span>
                    <div class="panel-actions">
                        <div class="search-box" style="width:180px;">
                            <span class="search-icon">&#128269;</span>
                            <input type="text" placeholder="Search keys/values..." id="treeSearch" oninput="onSearch(this.value)">
                        </div>
                        <span class="search-count" id="searchCount"></span>
                    </div>
                </div>
                <div class="output-area" id="outputArea">
                    <div style="color:var(--text-muted);text-align:center;padding-top:120px;">
                        <div style="font-size:3rem;margin-bottom:12px;">{ }</div>
                        <p>Formatted output will appear here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div class="status-item">
                <div class="status-dot neutral" id="statusDot"></div>
                <span id="statusText">Ready</span>
            </div>
        </div>

        <!-- Tree Controls (hidden by default) -->
        <div id="treeControls" style="display:none;margin-top:12px;">
            <div class="toolbar-group">
                <button class="btn btn-secondary btn-sm" onclick="toggleAllNodes(true)">&#128194; Expand All</button>
                <button class="btn btn-secondary btn-sm" onclick="toggleAllNodes(false)">&#128193; Collapse All</button>
            </div>
        </div>
    </main>

    <script>document.write(getFooterHTML());</script>

    <script>
        const input = document.getElementById('jsonInput');
        const output = document.getElementById('outputArea');
        let currentMode = 'code'; // 'code' or 'tree'
        let parsedData = null;

        // Update input size indicator
        input.addEventListener('input', () => {
            const size = new Blob([input.value]).size;
            document.getElementById('inputSize').textContent = input.value ? formatBytes(size) : '';
        });

        // Setup drop zone
        setupDropZone(document.getElementById('dropZone'), input, () => {
            formatJSON();
        });

        // Also handle drop on textarea
        input.addEventListener('dragover', e => e.preventDefault());
        input.addEventListener('drop', e => {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            if (file) readFile(file, input, () => formatJSON());
        });

        function getIndent() {
            const v = document.getElementById('indentSelect').value;
            return v === 'tab' ? '\t' : parseInt(v);
        }

        function formatJSON() {
            const text = input.value.trim();
            if (!text) {
                showStatus('Please enter JSON', 'invalid');
                return;
            }

            const result = parseJSON(text);
            if (!result.success) {
                showStatus(`Error: ${result.error.message}${result.error.line ? ` (line ${result.error.line}, col ${result.error.col})` : ''}`, 'invalid');
                output.innerHTML = `<div style="color:var(--error);padding:20px;"><strong>Invalid JSON</strong><br><br>${result.error.message}${result.error.line ? `<br>Line: ${result.error.line}, Column: ${result.error.col}` : ''}</div>`;
                return;
            }

            parsedData = result.data;
            const indent = getIndent();
            const formatted = JSON.stringify(parsedData, null, indent);
            input.value = formatted;

            // Show syntax highlighted output
            currentMode = 'code';
            output.innerHTML = `<div class="code-view">${syntaxHighlight(formatted)}</div>`;
            document.getElementById('outputTitle').textContent = 'Formatted Output';
            document.getElementById('treeControls').style.display = 'none';

            const stats = getJSONStats(parsedData);
            showStatus(`Valid JSON \u2014 ${stats.keys} keys, ${stats.objects} objects, ${stats.arrays} arrays, depth ${stats.depth}`, 'valid');

            // Update input size
            const size = new Blob([formatted]).size;
            document.getElementById('inputSize').textContent = formatBytes(size);
        }

        function viewTree() {
            const text = input.value.trim();
            if (!text) {
                showStatus('Please enter JSON', 'invalid');
                return;
            }

            const result = parseJSON(text);
            if (!result.success) {
                showStatus(`Error: ${result.error.message}`, 'invalid');
                return;
            }

            parsedData = result.data;
            currentMode = 'tree';
            output.innerHTML = `<div class="tree-view" id="treeOutput">${buildTreeHTML(parsedData)}</div>`;
            document.getElementById('outputTitle').textContent = 'Tree View';
            document.getElementById('treeControls').style.display = '';

            const stats = getJSONStats(parsedData);
            showStatus(`Valid JSON \u2014 ${stats.keys} keys, ${stats.objects} objects, ${stats.arrays} arrays, depth ${stats.depth}`, 'valid');
        }

        function onSearch(keyword) {
            const count = searchTree(keyword);
            document.getElementById('searchCount').textContent = keyword ? `${count} found` : '';
        }

        function copyOutput() {
            if (!parsedData) {
                showToast('Nothing to copy', 'error');
                return;
            }
            const indent = getIndent();
            copyToClipboard(JSON.stringify(parsedData, null, indent));
        }

        function downloadOutput() {
            if (!parsedData) {
                showToast('Nothing to download', 'error');
                return;
            }
            const indent = getIndent();
            downloadFile(JSON.stringify(parsedData, null, indent), 'formatted.json');
        }

        function clearAll() {
            input.value = '';
            output.innerHTML = `<div style="color:var(--text-muted);text-align:center;padding-top:120px;"><div style="font-size:3rem;margin-bottom:12px;">{ }</div><p>Formatted output will appear here</p></div>`;
            parsedData = null;
            currentMode = 'code';
            document.getElementById('inputSize').textContent = '';
            document.getElementById('treeControls').style.display = 'none';
            document.getElementById('outputTitle').textContent = 'Output';
            document.getElementById('searchCount').textContent = '';
            showStatus('Ready', 'neutral');
        }

        function loadSample() {
            const sample = {
                "name": "JSON Tools",
                "version": "1.0.0",
                "description": "A collection of free online JSON utilities",
                "features": ["Viewer", "Formatter", "Validator", "Converter", "Diff"],
                "author": {
                    "name": "Developer",
                    "email": "dev@example.com",
                    "website": "https://example.com"
                },
                "stats": {
                    "users": 15000,
                    "rating": 4.8,
                    "isOpen": true,
                    "lastUpdate": null
                },
                "tags": [
                    { "id": 1, "name": "json", "color": "#3b82f6" },
                    { "id": 2, "name": "tools", "color": "#22c55e" },
                    { "id": 3, "name": "online", "color": "#f59e0b" }
                ]
            };
            input.value = JSON.stringify(sample, null, 2);
            formatJSON();
        }

        function showStatus(text, type) {
            document.getElementById('statusText').textContent = text;
            const dot = document.getElementById('statusDot');
            dot.className = 'status-dot ' + type;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                formatJSON();
            }
        });
    </script>
</body>
</html>
