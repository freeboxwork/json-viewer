<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Diff Online - Compare Two JSON Objects</title>
    <meta name="description" content="Compare two JSON objects online for free. See differences highlighted with added, removed, and changed values.">
    <meta name="google-adsense-account" content="ca-pub-8753276846370247">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8753276846370247" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="app.js"></script>
    <script>document.write(getNavHTML('diff'));</script>

    <main>
        <div class="page-header">
            <h1>JSON Diff / Compare</h1>
            <p>Compare two JSON objects and see differences highlighted</p>
        </div>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="compareJSON()">&#128269; Compare</button>
            <button class="btn btn-secondary" onclick="swapInputs()">&#8646; Swap</button>
            <div class="toolbar-separator"></div>
            <button class="btn btn-secondary btn-sm" onclick="loadSample()">Sample</button>
            <button class="btn btn-danger btn-sm" onclick="clearAll()">&#128465; Clear</button>
        </div>

        <!-- Diff keeps side-by-side layout -->
        <div class="editor-layout">
            <div class="editor-panel">
                <div class="panel-header"><span class="panel-title">Original (Left)</span></div>
                <textarea class="editor-area" id="jsonLeft" placeholder="Paste original JSON here..." spellcheck="false"></textarea>
            </div>
            <div class="editor-panel">
                <div class="panel-header"><span class="panel-title">Modified (Right)</span></div>
                <textarea class="editor-area" id="jsonRight" placeholder="Paste modified JSON here..." spellcheck="false"></textarea>
            </div>
        </div>

        <!-- Diff Stats -->
        <div id="diffStats" style="display:none;margin-top:16px;">
            <div style="display:flex;gap:12px;flex-wrap:wrap;">
                <div class="card" style="padding:14px 20px;text-align:center;flex:1;min-width:100px;">
                    <div style="font-size:1.5rem;font-weight:800;color:var(--success);" id="addedCount">0</div>
                    <div style="font-size:0.78rem;color:var(--text-muted);">Added</div>
                </div>
                <div class="card" style="padding:14px 20px;text-align:center;flex:1;min-width:100px;">
                    <div style="font-size:1.5rem;font-weight:800;color:var(--error);" id="removedCount">0</div>
                    <div style="font-size:0.78rem;color:var(--text-muted);">Removed</div>
                </div>
                <div class="card" style="padding:14px 20px;text-align:center;flex:1;min-width:100px;">
                    <div style="font-size:1.5rem;font-weight:800;color:var(--warning);" id="changedCount">0</div>
                    <div style="font-size:0.78rem;color:var(--text-muted);">Changed</div>
                </div>
                <div class="card" style="padding:14px 20px;text-align:center;flex:1;min-width:100px;">
                    <div style="font-size:1.5rem;font-weight:800;color:var(--accent);" id="totalDiffs">0</div>
                    <div style="font-size:0.78rem;color:var(--text-muted);">Total</div>
                </div>
            </div>
        </div>

        <!-- Diff Results -->
        <div id="diffResults" style="display:none;margin-top:16px;">
            <div class="panel-header" style="border-radius:var(--radius) var(--radius) 0 0;">
                <span class="panel-title">Differences</span>
                <div class="panel-actions">
                    <button class="btn btn-secondary btn-sm" onclick="filterDiffs('all')" id="filterAll" style="border-color:var(--accent);">All</button>
                    <button class="btn btn-secondary btn-sm" onclick="filterDiffs('added')" id="filterAdded">Added</button>
                    <button class="btn btn-secondary btn-sm" onclick="filterDiffs('removed')" id="filterRemoved">Removed</button>
                    <button class="btn btn-secondary btn-sm" onclick="filterDiffs('changed')" id="filterChanged">Changed</button>
                </div>
            </div>
            <div style="border:1px solid var(--border-color);border-top:none;border-radius:0 0 var(--radius) var(--radius);overflow:auto;max-height:500px;" id="diffList"></div>
        </div>

        <div id="noDiff" style="display:none;margin-top:16px;">
            <div class="card" style="text-align:center;padding:40px;">
                <div style="font-size:3rem;margin-bottom:12px;">&#10003;</div>
                <h3 style="color:var(--success);margin-bottom:8px;">No Differences Found</h3>
                <p style="color:var(--text-muted);">Both JSON objects are identical</p>
            </div>
        </div>

        <div class="status-bar" style="margin-top:12px;"><div class="status-item"><div class="status-dot neutral" id="statusDot"></div><span id="statusText">Ready</span></div></div>
    </main>

    <script>document.write(getFooterHTML());</script>

    <script>
        let allDiffs = [];

        function compareJSON() {
            const lt = document.getElementById('jsonLeft').value.trim();
            const rt = document.getElementById('jsonRight').value.trim();
            if (!lt || !rt) { setStatus('Enter JSON in both panels', 'invalid'); return; }
            const lr = parseJSON(lt);
            if (!lr.success) { setStatus(`Left: ${lr.error.message}`, 'invalid'); return; }
            const rr = parseJSON(rt);
            if (!rr.success) { setStatus(`Right: ${rr.error.message}`, 'invalid'); return; }

            allDiffs = jsonDiff(lr.data, rr.data);
            const added = allDiffs.filter(d => d.type === 'added').length;
            const removed = allDiffs.filter(d => d.type === 'removed').length;
            const changed = allDiffs.filter(d => d.type === 'changed').length;

            document.getElementById('addedCount').textContent = added;
            document.getElementById('removedCount').textContent = removed;
            document.getElementById('changedCount').textContent = changed;
            document.getElementById('totalDiffs').textContent = allDiffs.length;

            if (allDiffs.length === 0) {
                document.getElementById('diffStats').style.display = 'none';
                document.getElementById('diffResults').style.display = 'none';
                document.getElementById('noDiff').style.display = '';
                setStatus('No differences', 'valid');
            } else {
                document.getElementById('diffStats').style.display = '';
                document.getElementById('diffResults').style.display = '';
                document.getElementById('noDiff').style.display = 'none';
                renderDiffs(allDiffs);
                setStatus(`${allDiffs.length} difference(s)`, 'invalid');
            }
        }

        function renderDiffs(diffs) {
            const list = document.getElementById('diffList');
            if (!diffs.length) { list.innerHTML = `<div style="padding:32px;text-align:center;color:var(--text-muted);">No items</div>`; return; }
            list.innerHTML = diffs.map(d => {
                const icon = d.type === 'added' ? '+' : d.type === 'removed' ? '-' : '~';
                let detail = '';
                if (d.type === 'changed') detail = `<div style="display:flex;gap:16px;flex-wrap:wrap;font-size:0.82rem;"><span style="color:var(--error);">- ${fmtVal(d.oldValue)}</span><span style="color:var(--success);">+ ${fmtVal(d.newValue)}</span></div>`;
                else detail = `<div style="font-size:0.82rem;color:${d.type==='added'?'var(--success)':'var(--error)'};">${icon} ${fmtVal(d.value)}</div>`;
                return `<div class="diff-${d.type}" style="padding:10px 16px;border-bottom:1px solid var(--border-color);font-family:monospace;font-size:0.85rem;" data-type="${d.type}"><div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="font-weight:700;">${icon} ${d.path}</span><span style="font-size:0.75rem;padding:2px 8px;border-radius:4px;background:rgba(255,255,255,0.06);">${d.type}</span></div>${detail}</div>`;
            }).join('');
        }

        function fmtVal(v) { if (v===null) return '<em>null</em>'; if (typeof v==='object') return esc(JSON.stringify(v)); if (typeof v==='string') return `"${esc(v)}"`; return String(v); }
        function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

        function filterDiffs(type) {
            ['All','Added','Removed','Changed'].forEach(t => { const b = document.getElementById('filter'+t); if(b) b.style.borderColor='var(--border-color)'; });
            const btn = document.getElementById('filter'+type.charAt(0).toUpperCase()+type.slice(1));
            if(btn) btn.style.borderColor='var(--accent)';
            renderDiffs(type==='all' ? allDiffs : allDiffs.filter(d=>d.type===type));
        }

        function swapInputs() { const l=document.getElementById('jsonLeft'),r=document.getElementById('jsonRight'),t=l.value; l.value=r.value; r.value=t; showToast('Swapped!'); }

        function loadSample() {
            document.getElementById('jsonLeft').value = JSON.stringify({"name":"JSON Tools","version":"1.0.0","features":["viewer","formatter","validator"],"config":{"theme":"dark","indent":2},"deprecated":"old"}, null, 2);
            document.getElementById('jsonRight').value = JSON.stringify({"name":"JSON Tools Pro","version":"2.0.0","features":["viewer","formatter","validator","diff"],"config":{"theme":"auto","indent":4,"newSetting":"enabled"}}, null, 2);
            compareJSON();
        }

        function clearAll() {
            document.getElementById('jsonLeft').value = '';
            document.getElementById('jsonRight').value = '';
            allDiffs = [];
            document.getElementById('diffStats').style.display = 'none';
            document.getElementById('diffResults').style.display = 'none';
            document.getElementById('noDiff').style.display = 'none';
            setStatus('Ready', 'neutral');
        }

        function setStatus(t, type) { document.getElementById('statusText').textContent = t; document.getElementById('statusDot').className = 'status-dot ' + type; }
    </script>
</body>
</html>
